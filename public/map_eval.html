<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Evaluation: Leaflet + OSRM</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
     
    <style>
        body { margin: 0; padding: 20px; font-family: sans-serif; }
        #map { height: 500px; width: 100%; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .controls { margin-bottom: 20px; padding: 15px; background: #f5f5f5; border-radius: 8px; }
        .stats { margin-top: 10px; padding: 10px; background: #e0f7fa; border-radius: 4px; display: none; }
        .btn { padding: 8px 16px; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .btn:hover { background: #1d4ed8; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div class="controls">
        <h2>Free Maps Evaluation: Leaflet + OSM + OSRM</h2>
        <div class="grid">
            <div>
                <label>Origin (Lat, Lng):</label><br>
                <input type="text" id="origin" value="-6.200000, 106.816666" style="width: 100%">
            </div>
            <div>
                <label>Destination (Lat, Lng):</label><br>
                <input type="text" id="dest" value="-6.229728, 106.804154" style="width: 100%">
            </div>
        </div>
        <button class="btn" onclick="calculateRoute()">Calculate Route & Render Map</button>
        <div id="stats" class="stats"></div>
    </div>

    <div id="map"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <script>
        let map = L.map('map').setView([-6.200000, 106.816666], 13);
        let routeLayer = null;
        let markers = [];

        // Add OpenStreetMap Tiles
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        async function calculateRoute() {
            const originVal = document.getElementById('origin').value.split(',');
            const destVal = document.getElementById('dest').value.split(',');

            const startLat = parseFloat(originVal[0].trim());
            const startLng = parseFloat(originVal[1].trim());
            const endLat = parseFloat(destVal[0].trim());
            const endLng = parseFloat(destVal[1].trim());

            // Clear previous
            if (routeLayer) map.removeLayer(routeLayer);
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            // Add markers
            const startMarker = L.marker([startLat, startLng]).addTo(map).bindPopup("Origin").openPopup();
            const endMarker = L.marker([endLat, endLng]).addTo(map).bindPopup("Destination");
            markers.push(startMarker, endMarker);

            // Fit bounds
            const group = new L.featureGroup([startMarker, endMarker]);
            map.fitBounds(group.getBounds(), { padding: [50, 50] });

            // Call OSRM API (Public Demo Server)
            // Format: /route/v1/driving/lon,lat;lon,lat?overview=full&geometries=geojson
            const osrmUrl = `https://router.project-osrm.org/route/v1/driving/${startLng},${startLat};${endLng},${endLat}?overview=full&geometries=geojson`;

            const startTime = performance.now();
            
            try {
                const response = await fetch(osrmUrl);
                const data = await response.json();
                const endTime = performance.now();

                if (data.code === 'Ok') {
                    const route = data.routes[0];
                    const durationMins = Math.round(route.duration / 60);
                    const distanceKm = (route.distance / 1000).toFixed(2);
                    
                    // Draw route
                    routeLayer = L.geoJSON(route.geometry, {
                        style: { color: 'blue', weight: 5, opacity: 0.7 }
                    }).addTo(map);

                    // Show stats
                    const statsDiv = document.getElementById('stats');
                    statsDiv.style.display = 'block';
                    statsDiv.innerHTML = `
                        <strong>Results:</strong><br>
                        Distance: ${distanceKm} km<br>
                        Duration: ${durationMins} mins<br>
                        API Latency: ${(endTime - startTime).toFixed(0)} ms<br>
                        Source: OSRM Public Demo Server
                    `;
                } else {
                    alert('Routing failed');
                }
            } catch (e) {
                console.error(e);
                alert('Error fetching route. The demo server might be busy.');
            }
        }
    </script>
</body>
</html>
